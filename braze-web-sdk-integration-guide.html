<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Braze Web SDK Integration Guide</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #667eea;
            --primary-dark: #5a6fd6;
            --secondary-color: #764ba2;
            --success-color: #10b981;
            --error-color: #ef4444;
            --warning-color: #f59e0b;
            --bg-color: #0f172a;
            --surface-color: #1e293b;
            --surface-hover: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --border-color: #334155;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.6);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: var(--bg-color);
            overflow-x: hidden;
        }

        .app-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            padding: 3rem 2rem;
            text-align: center;
            box-shadow: var(--shadow-xl);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.125rem;
            opacity: 0.95;
            position: relative;
            z-index: 1;
        }

        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .section-card {
            background: var(--surface-color);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .section-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--primary-color);
        }

        .section-icon {
            width: 2.5rem;
            height: 2.5rem;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .section-description {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .form-input, .form-select {
            width: 100%;
            max-width: 400px;
            padding: 0.75rem 1rem;
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.2s;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-input::placeholder {
            color: var(--text-muted);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            box-shadow: var(--shadow-md);
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .btn-secondary {
            background: var(--border-color);
            color: var(--text-primary);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-group {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .inline-form {
            display: flex;
            gap: 0.75rem;
            align-items: flex-end;
            flex-wrap: wrap;
        }

        .inline-form .form-input {
            flex: 1;
            min-width: 200px;
        }

        .toggle-section {
            background: var(--surface-hover);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .toggle-header {
            padding: 1rem 1.5rem;
            background: var(--surface-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background 0.2s;
        }

        .toggle-header:hover {
            background: var(--surface-hover);
        }

        .toggle-title {
            font-weight: 600;
            font-size: 1rem;
            color: var(--text-primary);
        }

        .toggle-icon {
            width: 1.5rem;
            height: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            transition: transform 0.2s;
        }

        .toggle-section.active .toggle-icon {
            transform: rotate(180deg);
        }

        .toggle-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .toggle-section.active .toggle-content {
            max-height: 2000px;
            transition: max-height 0.5s ease-in;
        }

        .toggle-content-inner {
            padding: 1.5rem;
        }

        .code-block {
            background: #1a1f2e;
            border-radius: 0.5rem;
            padding: 1.5rem;
            overflow-x: auto;
            margin: 1rem 0;
            border: 1px solid var(--border-color);
        }

        .code-block code {
            font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
            font-size: 0.875rem;
            line-height: 1.6;
            color: #f8f8f2;
        }

        .alert {
            padding: 1rem 1.25rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            border-left: 4px solid;
            display: none;
        }

        .alert.show {
            display: block;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-success {
            background: rgba(16, 185, 129, 0.1);
            border-color: var(--success-color);
            color: #6ee7b7;
        }

        .alert-error {
            background: rgba(239, 68, 68, 0.1);
            border-color: var(--error-color);
            color: #fca5a5;
        }

        .alert-warning {
            background: rgba(245, 158, 11, 0.1);
            border-color: var(--warning-color);
            color: #fcd34d;
        }

        .content-cards-container {
            min-height: 150px;
            border: 2px dashed var(--border-color);
            border-radius: 0.75rem;
            padding: 2rem;
            margin-top: 1rem;
            background: var(--bg-color);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: border-color 0.2s;
        }

        .content-cards-container:empty::before {
            content: 'Content cards will appear here';
            color: var(--text-muted);
            font-style: italic;
        }

        .note-card {
            background: rgba(245, 158, 11, 0.1);
            border-left: 4px solid var(--warning-color);
            padding: 1.25rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
        }

        .note-card strong {
            color: var(--warning-color);
            display: block;
            margin-bottom: 0.5rem;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.75rem;
            }

            .main-content {
                padding: 1rem;
            }

            .section-card {
                padding: 1.5rem;
            }

            .btn-group {
                flex-direction: column;
                align-items: stretch;
            }

            .btn {
                width: 100%;
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <div id="app" class="app-container"></div>

    <script type="text/javascript">
        // ============================================
        // BRAZE SDK ASYNC LOADER
        // ============================================
        +function(a,p,P,b,y){
            a.braze={};
            a.brazeQueue=[];
            for(var s="BrazeSdkMetadata DeviceProperties Card Card.prototype.dismissCard Card.prototype.removeAllSubscriptions Card.prototype.removeSubscription Card.prototype.subscribeToClickedEvent Card.prototype.subscribeToDismissedEvent Card.fromContentCardsJson ImageOnly CaptionedImage ClassicCard ControlCard ContentCards ContentCards.prototype.getUnviewedCardCount Feed Feed.prototype.getUnreadCardCount ControlMessage InAppMessage InAppMessage.SlideFrom InAppMessage.ClickAction InAppMessage.DismissType InAppMessage.OpenTarget InAppMessage.ImageStyle InAppMessage.Orientation InAppMessage.TextAlignment InAppMessage.CropType InAppMessage.prototype.closeMessage InAppMessage.prototype.removeAllSubscriptions InAppMessage.prototype.removeSubscription InAppMessage.prototype.subscribeToClickedEvent InAppMessage.prototype.subscribeToDismissedEvent InAppMessage.fromJson FullScreenMessage ModalMessage HtmlMessage SlideUpMessage User User.Genders User.NotificationSubscriptionTypes User.prototype.addAlias User.prototype.addToCustomAttributeArray User.prototype.addToSubscriptionGroup User.prototype.getUserId User.prototype.getUserId User.prototype.incrementCustomUserAttribute User.prototype.removeFromCustomAttributeArray User.prototype.removeFromSubscriptionGroup User.prototype.setCountry User.prototype.setCustomLocationAttribute User.prototype.setCustomUserAttribute User.prototype.setDateOfBirth User.prototype.setEmail User.prototype.setEmailNotificationSubscriptionType User.prototype.setFirstName User.prototype.setGender User.prototype.setHomeCity User.prototype.setLanguage User.prototype.setLastKnownLocation User.prototype.setLastName User.prototype.setPhoneNumber User.prototype.setPushNotificationSubscriptionType User.prototype.setLineId InAppMessageButton InAppMessageButton.prototype.removeAllSubscriptions InAppMessageButton.prototype.removeSubscription InAppMessageButton.prototype.subscribeToClickedEvent FeatureFlag FeatureFlag.prototype.getStringProperty FeatureFlag.prototype.getNumberProperty FeatureFlag.prototype.getBooleanProperty FeatureFlag.prototype.getImageProperty FeatureFlag.prototype.getJsonProperty FeatureFlag.prototype.getTimestampProperty Banner automaticallyShowInAppMessages destroyFeed hideContentCards showContentCards showFeed showInAppMessage deferInAppMessage toggleContentCards toggleFeed changeUser destroy getDeviceId getDeviceId initialize isPushBlocked isPushPermissionGranted isPushSupported logCardClick logCardDismissal logCardImpressions logContentCardImpressions logContentCardClick logCustomEvent logFeedDisplayed logInAppMessageButtonClick logInAppMessageClick logInAppMessageHtmlClick logInAppMessageImpression logPurchase openSession requestPushPermission removeAllSubscriptions removeSubscription requestContentCardsRefresh requestFeedRefresh refreshFeatureFlags requestImmediateDataFlush enableSDK isDisabled setLogger setSdkAuthenticationSignature addSdkMetadata disableSDK subscribeToContentCardsUpdates subscribeToFeedUpdates subscribeToInAppMessage subscribeToSdkAuthenticationFailures toggleLogging unregisterPush wipeData handleBrazeAction subscribeToFeatureFlagsUpdates getAllFeatureFlags logFeatureFlagImpression requestBannersRefresh insertBanner logBannerClick logBannerImpressions getAllBanners subscribeToBannersUpdates isInitialized".split(" "),i=0;i<s.length;i++){
                for(var m=s[i],k=a.braze,l=m.split("."),j=0;j<l.length-1;j++)k=k[l[j]];
                k[l[j]]=(new Function("return function "+m.replace(/\./g,"_")+"(){window.brazeQueue.push(arguments); return true}"))()
            }
            window.braze.getDeferredInAppMessage=function(){return new window.braze.InAppMessage};
            window.braze.getCachedContentCards=function(){return new window.braze.ContentCards};
            window.braze.getCachedFeed=function(){return new window.braze.Feed};
            window.braze.getUser=function(){return new window.braze.User};
            window.braze.getFeatureFlag=function(){return new window.braze.FeatureFlag};
            window.braze.getBanner=function(){return new window.braze.Banner};
            window.braze.newBannerFromJson=function(){return new window.braze.Banner};
            (y=p.createElement(P)).type='text/javascript';
            y.src='https://js.appboycdn.com/web-sdk/5.7/braze.min.js';
            y.async=1;
            y.onload = function() {
                braze.initialize('YOUR_API_KEY', {
                    baseUrl: "YOUR_SDK_ENDPOINT",
                    allowUserSuppliedJavascript: true,
                    minimumIntervalBetweenTriggerActionsInSeconds: 0,
                    enableLogging: true
                });

                braze.openSession();
                braze.requestContentCardsRefresh();

                braze.subscribeToContentCardsUpdates(function(cards) {
                    console.log("Content Cards Updated:", cards);
                });

                // Initialize app after SDK loads
                window.BrazeIntegrationApp && window.BrazeIntegrationApp.init();
            };
            (b=p.getElementsByTagName(P)[0]).parentNode.insertBefore(y,b);
        }(window,document,'script');

        // ============================================
        // MODERN UI COMPONENT SYSTEM
        // ============================================
        window.BrazeIntegrationApp = (function() {
            'use strict';

            // Utility functions
            const utils = {
                createElement(tag, className, content) {
                    const el = document.createElement(tag);
                    if (className) el.className = className;
                    if (content) el.innerHTML = content;
                    return el;
                },

                showAlert(containerId, message, type = 'success') {
                    const container = document.getElementById(containerId);
                    if (!container) return;

                    container.textContent = message;
                    container.className = `alert alert-${type} show`;

                    setTimeout(() => {
                        container.classList.remove('show');
                    }, 3000);
                },

                toggleSection(sectionId) {
                    const section = document.getElementById(sectionId);
                    if (section) {
                        section.classList.toggle('active');
                    }
                }
            };

            // Component builders
            const components = {
                header() {
                    return `
                        <div class="header">
                            <h1>Braze Web SDK Integration Guide</h1>
                            <p>Complete end-to-end integration example with all SDK features</p>
                        </div>
                    `;
                },

                sectionCard(config) {
                    const { id, icon, title, description, content } = config;
                    return `
                        <div class="section-card fade-in">
                            <div class="section-header">
                                <div class="section-icon">${icon}</div>
                                <h2 class="section-title">${title}</h2>
                            </div>
                            <p class="section-description">${description}</p>
                            ${content}
                        </div>
                    `;
                },

                toggleSection(config) {
                    const { id, title, content } = config;
                    return `
                        <div class="toggle-section" id="${id}">
                            <div class="toggle-header" onclick="BrazeIntegrationApp.toggleSection('${id}')">
                                <span class="toggle-title">${title}</span>
                                <span class="toggle-icon">‚ñº</span>
                            </div>
                            <div class="toggle-content">
                                <div class="toggle-content-inner">
                                    ${content}
                                </div>
                            </div>
                        </div>
                    `;
                },

                formGroup(config) {
                    const { label, id, type = 'text', placeholder = '', value = '' } = config;
                    return `
                        <div class="form-group">
                            <label class="form-label">${label}</label>
                            <input type="${type}" id="${id}" class="form-input"
                                   placeholder="${placeholder}" value="${value}">
                        </div>
                    `;
                },

                codeBlock(code) {
                    return `<div class="code-block"><code>${code.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</code></div>`;
                },

                noteCard(content) {
                    return `<div class="note-card">${content}</div>`;
                }
            };

            // Section definitions
            const sections = {
                initialization() {
                    return components.sectionCard({
                        id: 'sdk-init',
                        icon: 'üöÄ',
                        title: '1. SDK Initialization',
                        description: 'The Braze Web SDK must be loaded and initialized before any other SDK calls.',
                        content: `
                            ${components.noteCard(`
                                <strong>Configuration Required:</strong>
                                Replace the API key and baseUrl with your Braze workspace credentials.
                            `)}
                            ${components.codeBlock(`// BRAZE SDK ASYNC LOADER
<script type="text/javascript">
+function(a,p,P,b,y){
    a.braze={};
    a.brazeQueue=[];
    // Creates stub methods that queue calls until SDK loads
    for(var s="BrazeSdkMetadata DeviceProperties Card ... isInitialized".split(" "),i=0;i<s.length;i++){
        for(var m=s[i],k=a.braze,l=m.split("."),j=0;j<l.length-1;j++)k=k[l[j]];
        k[l[j]]=(new Function("return function "+m.replace(/\\\\./g,"_")+"(){window.brazeQueue.push(arguments); return true}"))()
    }

    // Load the SDK script asynchronously
    (y=p.createElement(P)).type='text/javascript';
    y.src='https://js.appboycdn.com/web-sdk/5.7/braze.min.js';
    y.async=1;

    // Initialize SDK after script loads
    y.onload = function() {
        braze.initialize('YOUR_API_KEY', {
            baseUrl: "YOUR_SDK_ENDPOINT",       // e.g., "sdk.iad-01.braze.com"
            allowUserSuppliedJavascript: true,  // Required for HTML in-app messages
            minimumIntervalBetweenTriggerActionsInSeconds: 0,
            enableLogging: true                  // Set to false in production
        });

        braze.openSession();
        braze.requestContentCardsRefresh();

        braze.subscribeToContentCardsUpdates(function(cards) {
            console.log("Content Cards Updated:", cards);
        });
    };

    (b=p.getElementsByTagName(P)[0]).parentNode.insertBefore(y,b);
}(window,document,'script');
</script>`)}
                        `
                    });
                },

                userIdentification() {
                    return components.sectionCard({
                        id: 'user-id',
                        icon: 'üë§',
                        title: '2. User Identification',
                        description: 'Identify users to enable cross-device tracking and personalization.',
                        content: `
                            ${components.toggleSection({
                                id: 'user-id-toggle',
                                title: 'Change User / Set User ID',
                                content: `
                                    <div class="inline-form">
                                        <input type="text" id="change_user_text" class="form-input"
                                               placeholder="Enter User ID">
                                        <button class="btn btn-primary" id="change_user_button">Set User ID</button>
                                    </div>
                                    <div id="user-id-status" class="alert"></div>
                                    ${components.codeBlock(`// Change the current user (call after login/signup)
braze.changeUser("user_id_123");

// For URL-based user identification (e.g., email links)
function getUserFromURL() {
    const urlParams = new URLSearchParams(window.location.search);
    const encodedUserId = urlParams.get("id");
    if (encodedUserId) {
        const decodedUserId = atob(encodedUserId); // Base64 decode
        braze.changeUser(decodedUserId);
    }
}`)}
                                `
                            })}
                        `
                    });
                },

                userAttributes() {
                    return components.sectionCard({
                        id: 'user-attrs',
                        icon: 'üìù',
                        title: '3. User Attributes',
                        description: 'Set standard and custom user attributes for segmentation and personalization.',
                        content: `
                            ${components.toggleSection({
                                id: 'user-attrs-toggle',
                                title: 'Set User Attributes',
                                content: `
                                    <div class="grid-2">
                                        ${components.formGroup({ label: 'First Name', id: 'fn_text', placeholder: 'Enter first name' })}
                                        ${components.formGroup({ label: 'Last Name', id: 'ln_text', placeholder: 'Enter last name' })}
                                        ${components.formGroup({ label: 'Email Address', id: 'email_text', type: 'email', placeholder: 'Enter email' })}
                                        ${components.formGroup({ label: 'Country', id: 'country_text', placeholder: 'Enter country' })}
                                        ${components.formGroup({ label: 'Home City', id: 'home_city_text', placeholder: 'Enter home city' })}
                                        ${components.formGroup({ label: 'Phone Number', id: 'phone_number_text', placeholder: 'Enter phone number' })}
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">Gender</label>
                                        <select id="gender" class="form-select">
                                            <option value="male">Male</option>
                                            <option value="female">Female</option>
                                            <option value="other">Other</option>
                                            <option value="unknown">Unknown</option>
                                            <option value="not_applicable">Not Applicable</option>
                                            <option value="prefer_not_to_say">Prefer Not To Say</option>
                                        </select>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">Birthday</label>
                                        <input type="date" id="birthday" class="form-input">
                                    </div>

                                    <div class="btn-group">
                                        <button class="btn btn-primary" id="fn_button">Set First Name</button>
                                        <button class="btn btn-primary" id="ln_button">Set Last Name</button>
                                        <button class="btn btn-primary" id="email_button">Set Email</button>
                                        <button class="btn btn-primary" id="gender_button">Set Gender</button>
                                        <button class="btn btn-primary" id="birthday_button">Set Birthday</button>
                                        <button class="btn btn-primary" id="country_button">Set Country</button>
                                        <button class="btn btn-primary" id="home_city_button">Set Home City</button>
                                        <button class="btn btn-primary" id="phone_number_button">Set Phone Number</button>
                                    </div>

                                    ${components.codeBlock(`// Standard User Attributes
const user = braze.getUser();

user.setFirstName("John");
user.setLastName("Doe");
user.setEmail("john.doe@example.com");
user.setGender(braze.User.Genders.MALE);  // MALE, FEMALE, OTHER, UNKNOWN, NOT_APPLICABLE, PREFER_NOT_TO_SAY
user.setDateOfBirth(1990, 5, 15);         // year, month (1-12), day
user.setCountry("United States");
user.setHomeCity("New York");
user.setPhoneNumber("+1234567890");
user.setLanguage("en");`)}
                                `
                            })}
                        `
                    });
                },

                customAttributes() {
                    return components.sectionCard({
                        id: 'custom-attrs',
                        icon: '‚öôÔ∏è',
                        title: '4. Custom Attributes',
                        description: 'Set custom user attributes for advanced segmentation.',
                        content: `
                            ${components.toggleSection({
                                id: 'custom-attrs-toggle',
                                title: 'Set Custom Attributes',
                                content: `
                                    ${components.formGroup({ label: 'Attribute Name', id: 'attribute_name', placeholder: 'e.g., favorite_color' })}
                                    ${components.formGroup({ label: 'Attribute Value (comma-separated for arrays)', id: 'attribute_value', placeholder: 'e.g., blue or red,green,blue' })}
                                    <button class="btn btn-primary" id="attribute_button">Set Custom Attribute</button>
                                    ${components.codeBlock(`// Set custom attributes
const user = braze.getUser();

// String attribute
user.setCustomUserAttribute("favorite_color", "blue");

// Number attribute
user.setCustomUserAttribute("loyalty_points", 500);

// Boolean attribute
user.setCustomUserAttribute("is_premium_member", true);

// Date attribute
user.setCustomUserAttribute("last_purchase_date", new Date());

// Array attribute
user.setCustomUserAttribute("favorite_genres", ["rock", "jazz", "classical"]);

// Add to array
user.addToCustomAttributeArray("favorite_genres", "blues");

// Remove from array
user.removeFromCustomAttributeArray("favorite_genres", "rock");

// Increment numeric attribute
user.incrementCustomUserAttribute("loyalty_points", 50);`)}
                                `
                            })}
                        `
                    });
                },

                customEvents() {
                    return components.sectionCard({
                        id: 'custom-events',
                        icon: 'üìä',
                        title: '5. Custom Events',
                        description: 'Track user actions and behaviors with custom events.',
                        content: `
                            ${components.toggleSection({
                                id: 'custom-events-toggle',
                                title: 'Log Custom Events',
                                content: `
                                    ${components.formGroup({ label: 'Event Name', id: 'event_name', placeholder: 'e.g., clicked_button' })}
                                    ${components.formGroup({ label: 'Event Properties (JSON, optional)', id: 'properties', placeholder: 'e.g., {"button_id": "cta_1"}' })}
                                    <button class="btn btn-primary" id="event_button">Log Event</button>
                                    ${components.codeBlock(`// Log a simple event
braze.logCustomEvent("viewed_product");

// Log event with properties
braze.logCustomEvent("added_to_cart", {
    product_id: "SKU123",
    product_name: "Blue Widget",
    price: 29.99,
    quantity: 2,
    category: "widgets"
});

// Log event with nested properties
braze.logCustomEvent("completed_level", {
    level: 5,
    score: 1500,
    time_spent: 120,
    achievements: ["first_win", "speed_demon"]
});`)}
                                `
                            })}
                        `
                    });
                },

                purchases() {
                    return components.sectionCard({
                        id: 'purchases',
                        icon: 'üí≥',
                        title: '6. Purchase Tracking',
                        description: 'Track purchases for revenue analytics and segmentation.',
                        content: `
                            ${components.toggleSection({
                                id: 'purchases-toggle',
                                title: 'Log Purchases',
                                content: `
                                    <div class="grid-2">
                                        ${components.formGroup({ label: 'Product ID', id: 'product_id', placeholder: 'e.g., SKU123' })}
                                        ${components.formGroup({ label: 'Currency Code', id: 'currency', placeholder: 'e.g., USD', value: 'USD' })}
                                        ${components.formGroup({ label: 'Price', id: 'price', type: 'number', placeholder: 'e.g., 29.99' })}
                                        ${components.formGroup({ label: 'Quantity', id: 'quantity', type: 'number', placeholder: 'e.g., 1', value: '1' })}
                                    </div>
                                    <button class="btn btn-primary" id="log_purchase_button">Log Purchase</button>
                                    ${components.codeBlock(`// Log a simple purchase
braze.logPurchase("product_sku", 29.99, "USD", 1);

// Log purchase with properties
braze.logPurchase("product_sku", 29.99, "USD", 2, {
    category: "electronics",
    brand: "Acme",
    coupon_code: "SAVE10",
    is_gift: false
});`)}
                                `
                            })}
                        `
                    });
                },

                contentCards() {
                    return components.sectionCard({
                        id: 'content-cards',
                        icon: 'üé¥',
                        title: '7. Content Cards',
                        description: 'Display personalized content cards to users.',
                        content: `
                            <div class="btn-group">
                                <button class="btn btn-primary" id="toggle">Toggle Cards Feed</button>
                                <button class="btn btn-secondary" id="hide">Hide Cards</button>
                                <button class="btn btn-success" id="show">Show Cards</button>
                                <button class="btn btn-primary" id="refresh-cards">Refresh Cards</button>
                            </div>
                            <div id="content-cards-container" class="content-cards-container"></div>
                            ${components.codeBlock(`// Show content cards in a container
const container = document.getElementById("content-cards-container");
braze.showContentCards(container);

// Hide content cards
braze.hideContentCards();

// Toggle content cards visibility
braze.toggleContentCards(container);

// Request a refresh of content cards
braze.requestContentCardsRefresh();

// Subscribe to content card updates
braze.subscribeToContentCardsUpdates(function(cards) {
    console.log("Received cards:", cards.cards);
    console.log("Unviewed count:", cards.getUnviewedCardCount());

    // Process cards manually if needed
    cards.cards.forEach(function(card) {
        console.log("Card ID:", card.id);
        console.log("Card Title:", card.title);

        // Log impression
        braze.logContentCardImpressions([card]);

        // Log click (call when user clicks)
        braze.logContentCardClick(card);
    });
});

// Dismiss a card
card.dismissCard();`)}
                        `
                    });
                },

                inAppMessages() {
                    return components.sectionCard({
                        id: 'in-app-messages',
                        icon: 'üí¨',
                        title: '8. In-App Messages',
                        description: 'Display and handle in-app messages.',
                        content: components.codeBlock(`// Automatically show in-app messages (default behavior)
braze.automaticallyShowInAppMessages();

// Or manually handle in-app messages
braze.subscribeToInAppMessage(function(inAppMessage) {
    // Inspect the message
    console.log("Received IAM:", inAppMessage);

    // Show it
    braze.showInAppMessage(inAppMessage);

    // Or defer it for later
    // braze.deferInAppMessage(inAppMessage);

    // Log impression (automatic if shown via showInAppMessage)
    braze.logInAppMessageImpression(inAppMessage);

    // Log click
    braze.logInAppMessageClick(inAppMessage);

    // For messages with buttons
    if (inAppMessage.buttons && inAppMessage.buttons.length > 0) {
        inAppMessage.buttons.forEach(function(button, index) {
            // Log button click
            braze.logInAppMessageButtonClick(inAppMessage, button);
        });
    }

    // Close the message programmatically
    inAppMessage.closeMessage();
});

// Subscribe to click events on a message
inAppMessage.subscribeToClickedEvent(function() {
    console.log("Message was clicked");
});

// Subscribe to dismiss events
inAppMessage.subscribeToDismissedEvent(function() {
    console.log("Message was dismissed");
});`)
                    });
                },

                pushNotifications() {
                    return components.sectionCard({
                        id: 'push-notifications',
                        icon: 'üîî',
                        title: '9. Push Notifications',
                        description: 'Enable web push notifications for your users.',
                        content: `
                            <button class="btn btn-primary" id="request-push">Request Push Permission</button>
                            <div id="push-status" class="alert"></div>
                            ${components.noteCard(`
                                <strong>Service Worker Required:</strong>
                                Create a <code>service-worker.js</code> file in your root directory with the following content:
                            `)}
                            ${components.codeBlock(`// service-worker.js (place in your web root)
self.importScripts('https://js.appboycdn.com/web-sdk/5.7/service-worker.js');`)}
                            ${components.codeBlock(`// Check if push is supported
if (braze.isPushSupported()) {
    console.log("Push is supported");
}

// Check if push permission is granted
braze.isPushPermissionGranted().then(function(isGranted) {
    console.log("Push permission granted:", isGranted);
});

// Check if push is blocked
braze.isPushBlocked().then(function(isBlocked) {
    console.log("Push is blocked:", isBlocked);
});

// Request push permission (shows browser prompt)
braze.requestPushPermission(
    function() {
        console.log("Push permission granted!");
    },
    function() {
        console.log("Push permission denied");
    }
);

// Unregister from push
braze.unregisterPush();

// Set push notification subscription type
const user = braze.getUser();
user.setPushNotificationSubscriptionType(
    braze.User.NotificationSubscriptionTypes.OPTED_IN
    // Options: OPTED_IN, SUBSCRIBED, UNSUBSCRIBED
);`)}
                        `
                    });
                },

                featureFlags() {
                    return components.sectionCard({
                        id: 'feature-flags',
                        icon: 'üö©',
                        title: '10. Feature Flags',
                        description: 'Control feature rollouts and A/B tests with feature flags.',
                        content: components.codeBlock(`// Refresh feature flags from server
braze.refreshFeatureFlags();

// Get all feature flags
const allFlags = braze.getAllFeatureFlags();
console.log("All feature flags:", allFlags);

// Get a specific feature flag
const flag = braze.getFeatureFlag("my_feature_flag");

if (flag && flag.enabled) {
    // Feature is enabled, use its properties
    const stringProp = flag.getStringProperty("button_text");
    const numberProp = flag.getNumberProperty("max_items");
    const boolProp = flag.getBooleanProperty("show_banner");
    const imageProp = flag.getImageProperty("hero_image");
    const jsonProp = flag.getJsonProperty("config");
    const timestampProp = flag.getTimestampProperty("start_date");

    console.log("Feature properties:", {
        stringProp, numberProp, boolProp, imageProp, jsonProp, timestampProp
    });
}

// Log feature flag impression (for analytics)
braze.logFeatureFlagImpression("my_feature_flag");

// Subscribe to feature flag updates
braze.subscribeToFeatureFlagsUpdates(function(flags) {
    console.log("Feature flags updated:", flags);
});`)
                    });
                },

                dataManagement() {
                    return components.sectionCard({
                        id: 'data-management',
                        icon: 'üîß',
                        title: '11. Data Management & Utilities',
                        description: 'Manage data flushing, SDK state, and debugging.',
                        content: `
                            <div class="btn-group">
                                <button class="btn btn-primary" id="flush-data">Flush Data Now</button>
                                <button class="btn btn-secondary" id="toggle-logging">Toggle Logging</button>
                                <button class="btn btn-secondary" id="get-device-id">Get Device ID</button>
                            </div>
                            <div id="device-id-display" class="alert"></div>
                            ${components.codeBlock(`// Force immediate data flush to Braze servers
braze.requestImmediateDataFlush();

// Get the device ID
braze.getDeviceId(function(deviceId) {
    console.log("Device ID:", deviceId);
});

// Enable/disable SDK
braze.disableSDK();
braze.enableSDK();

// Check if SDK is disabled
const isDisabled = braze.isDisabled();

// Check if SDK is initialized
const isInitialized = braze.isInitialized();

// Toggle console logging (useful for debugging)
braze.toggleLogging();

// Set a custom logger
braze.setLogger(function(message) {
    console.log("[Braze]", message);
});

// Wipe all user data (use with caution!)
braze.wipeData();

// Destroy the SDK instance
braze.destroy();

// Set SDK authentication signature (for SDK Authentication feature)
braze.setSdkAuthenticationSignature("your_jwt_token");

// Subscribe to SDK authentication failures
braze.subscribeToSdkAuthenticationFailures(function(event) {
    console.log("Auth failure:", event);
    // Refresh the token and set again
});`)}
                        `
                    });
                },

                userAliases() {
                    return components.sectionCard({
                        id: 'user-aliases',
                        icon: 'üë•',
                        title: '12. User Aliases & Subscription Groups',
                        description: 'Manage user aliases and subscription group membership.',
                        content: components.codeBlock(`const user = braze.getUser();

// Add an alias to the user
user.addAlias("my_alias", "alias_label");

// Add user to a subscription group
user.addToSubscriptionGroup("subscription_group_id");

// Remove user from a subscription group
user.removeFromSubscriptionGroup("subscription_group_id");

// Set email notification subscription type
user.setEmailNotificationSubscriptionType(
    braze.User.NotificationSubscriptionTypes.OPTED_IN
    // Options: OPTED_IN, SUBSCRIBED, UNSUBSCRIBED
);

// Get the user ID (async)
user.getUserId(function(userId) {
    console.log("User ID:", userId);
});`)
                    });
                }
            };

            // Event handlers
            const handlers = {
                setupUserIdentification() {
                    const btn = document.getElementById('change_user_button');
                    const input = document.getElementById('change_user_text');

                    if (btn) {
                        btn.addEventListener('click', function() {
                            const userId = input.value;
                            if (userId) {
                                braze.changeUser(userId);
                                utils.showAlert('user-id-status', 'User changed to: ' + userId, 'success');
                                console.log('User changed to:', userId);
                            }
                        });
                    }

                    if (input) {
                        input.addEventListener('keyup', function(e) {
                            if (e.keyCode === 13) btn.click();
                        });
                    }
                },

                setupUserAttributes() {
                    const attributeHandlers = {
                        fn_button: () => braze.getUser().setFirstName(document.getElementById('fn_text').value),
                        ln_button: () => braze.getUser().setLastName(document.getElementById('ln_text').value),
                        email_button: () => braze.getUser().setEmail(document.getElementById('email_text').value),
                        country_button: () => braze.getUser().setCountry(document.getElementById('country_text').value),
                        home_city_button: () => braze.getUser().setHomeCity(document.getElementById('home_city_text').value),
                        phone_number_button: () => braze.getUser().setPhoneNumber(document.getElementById('phone_number_text').value),
                        gender_button: () => {
                            const select = document.getElementById('gender');
                            const value = select.value;
                            const genderMap = {
                                'male': braze.User.Genders.MALE,
                                'female': braze.User.Genders.FEMALE,
                                'other': braze.User.Genders.OTHER,
                                'unknown': braze.User.Genders.UNKNOWN,
                                'not_applicable': braze.User.Genders.NOT_APPLICABLE,
                                'prefer_not_to_say': braze.User.Genders.PREFER_NOT_TO_SAY
                            };
                            braze.getUser().setGender(genderMap[value]);
                        },
                        birthday_button: () => {
                            const value = document.getElementById('birthday').value;
                            if (value) {
                                const year = parseInt(value.substring(0, 4));
                                const month = parseInt(value.substring(5, 7));
                                const day = parseInt(value.substring(8, 10));
                                braze.getUser().setDateOfBirth(year, month, day);
                            }
                        }
                    };

                    Object.keys(attributeHandlers).forEach(id => {
                        const btn = document.getElementById(id);
                        if (btn) {
                            btn.addEventListener('click', attributeHandlers[id]);
                        }
                    });
                },

                setupCustomAttributes() {
                    const btn = document.getElementById('attribute_button');
                    if (btn) {
                        btn.addEventListener('click', function() {
                            const name = document.getElementById('attribute_name').value;
                            const value = document.getElementById('attribute_value').value;
                            if (name && value) {
                                if (value.includes(',')) {
                                    const array = value.split(',').map(s => s.trim());
                                    braze.getUser().setCustomUserAttribute(name, array);
                                } else {
                                    braze.getUser().setCustomUserAttribute(name, value);
                                }
                            }
                        });
                    }
                },

                setupCustomEvents() {
                    const btn = document.getElementById('event_button');
                    if (btn) {
                        btn.addEventListener('click', function() {
                            const eventName = document.getElementById('event_name').value;
                            const propsStr = document.getElementById('properties').value;

                            if (eventName) {
                                if (propsStr) {
                                    try {
                                        const props = JSON.parse(propsStr);
                                        braze.logCustomEvent(eventName, props);
                                    } catch (e) {
                                        braze.logCustomEvent(eventName, { value: propsStr });
                                    }
                                } else {
                                    braze.logCustomEvent(eventName);
                                }
                            }
                        });
                    }
                },

                setupPurchases() {
                    const btn = document.getElementById('log_purchase_button');
                    if (btn) {
                        btn.addEventListener('click', function() {
                            const productId = document.getElementById('product_id').value;
                            const currency = document.getElementById('currency').value || 'USD';
                            const price = parseFloat(document.getElementById('price').value);
                            const quantity = parseInt(document.getElementById('quantity').value) || 1;

                            if (productId && price) {
                                braze.logPurchase(productId, price, currency, quantity);
                            }
                        });
                    }
                },

                setupContentCards() {
                    const toggle = document.getElementById('toggle');
                    const hide = document.getElementById('hide');
                    const show = document.getElementById('show');
                    const refresh = document.getElementById('refresh-cards');
                    const feed = document.getElementById('content-cards-container');

                    if (toggle) toggle.onclick = () => braze.toggleContentCards(feed);
                    if (hide) hide.onclick = () => braze.hideContentCards();
                    if (show) show.onclick = () => braze.showContentCards(feed);
                    if (refresh) refresh.onclick = () => braze.requestContentCardsRefresh();
                },

                setupPushNotifications() {
                    const btn = document.getElementById('request-push');
                    if (btn) {
                        btn.addEventListener('click', function() {
                            if (braze.isPushSupported()) {
                                braze.requestPushPermission(
                                    () => utils.showAlert('push-status', 'Push permission granted!', 'success'),
                                    () => utils.showAlert('push-status', 'Push permission denied', 'error')
                                );
                            } else {
                                utils.showAlert('push-status', 'Push not supported in this browser', 'error');
                            }
                        });
                    }
                },

                setupDataManagement() {
                    const flushBtn = document.getElementById('flush-data');
                    const loggingBtn = document.getElementById('toggle-logging');
                    const deviceIdBtn = document.getElementById('get-device-id');

                    if (flushBtn) {
                        flushBtn.addEventListener('click', function() {
                            braze.requestImmediateDataFlush();
                            alert('Data flush requested');
                        });
                    }

                    if (loggingBtn) {
                        loggingBtn.addEventListener('click', function() {
                            braze.toggleLogging();
                            alert('Logging toggled - check console');
                        });
                    }

                    if (deviceIdBtn) {
                        deviceIdBtn.addEventListener('click', function() {
                            braze.getDeviceId(function(deviceId) {
                                utils.showAlert('device-id-display', 'Device ID: ' + deviceId, 'success');
                            });
                        });
                    }
                },

                setupURLUserIdentification() {
                    const urlParams = new URLSearchParams(window.location.search);
                    const encodedUserId = urlParams.get('id');
                    if (encodedUserId) {
                        try {
                            const decodedUserId = atob(encodedUserId);
                            console.log('Decoded User ID from URL:', decodedUserId);
                            setTimeout(() => braze.changeUser(decodedUserId), 1000);
                        } catch (e) {
                            console.error('Error decoding user ID:', e);
                        }
                    }
                }
            };

            // Main app initialization
            function init() {
                const app = document.getElementById('app');

                app.innerHTML = `
                    ${components.header()}
                    <div class="main-content">
                        ${sections.initialization()}
                        ${sections.userIdentification()}
                        ${sections.userAttributes()}
                        ${sections.customAttributes()}
                        ${sections.customEvents()}
                        ${sections.purchases()}
                        ${sections.contentCards()}
                        ${sections.inAppMessages()}
                        ${sections.pushNotifications()}
                        ${sections.featureFlags()}
                        ${sections.dataManagement()}
                        ${sections.userAliases()}
                    </div>
                `;

                // Setup all event handlers
                handlers.setupUserIdentification();
                handlers.setupUserAttributes();
                handlers.setupCustomAttributes();
                handlers.setupCustomEvents();
                handlers.setupPurchases();
                handlers.setupContentCards();
                handlers.setupPushNotifications();
                handlers.setupDataManagement();
                handlers.setupURLUserIdentification();
            }

            // Public API
            return {
                init,
                toggleSection: utils.toggleSection
            };
        })();

        // Initialize app on load
        window.addEventListener('load', function() {
            if (window.braze && window.braze.isInitialized && window.braze.isInitialized()) {
                window.BrazeIntegrationApp.init();
            }
        });
    </script>
</body>
</html>
